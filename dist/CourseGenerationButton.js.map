{"version":3,"file":"CourseGenerationButton.js","names":["_react","_interopRequireWildcard","require","_CourseGenerationModal","_interopRequireDefault","_hooks","e","__esModule","default","t","WeakMap","r","n","o","i","f","__proto__","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","CourseGenerationButton","_ref","buttonText","buttonIcon","buttonClassName","uploadUrl","maxFileSizeMB","onSuccess","onError","showModal","setShowModal","useState","generateCourse","isLoading","useCourseGeneration","courseId","getCourseIdFromUrl","handleGenerate","_ref2","file","instructions","error","Error","formData","FormData","append","uploadResponse","fetch","method","body","credentials","headers","getCsrfToken","ok","errorData","json","uploadResult","jobData","job_type","input_data","file_id","jobResult","jobId","id","message","console","cookies","document","cookie","split","name","value","trim","csrfMeta","querySelector","getAttribute","createElement","Fragment","className","onClick","disabled","title","style","marginRight","isOpen","onClose","onGenerate"],"sources":["../src/CourseGenerationButton.jsx"],"sourcesContent":["import React, { useState } from 'react';\nimport CourseGenerationModal from './CourseGenerationModal';\nimport { getCourseIdFromUrl, useCourseGeneration } from './data/hooks';\nimport './AIChatWidget.css';\n\n/**\n * CourseGenerationButton\n * - Simple button component that opens the course generation modal\n * - Handles the modal state and API calls\n * - Can be easily imported and used in Tutor plugin slots\n */\nexport default function CourseGenerationButton({\n  buttonText = \"AI Generate\",\n  buttonIcon = \"ðŸª„\",\n  buttonClassName = \"btn btn-primary\",\n  uploadUrl = \"/api/ai-assistant/upload\",\n  maxFileSizeMB = 50,\n  onSuccess = () => {},\n  onError = () => {},\n}) {\n  const [showModal, setShowModal] = useState(false);\n  const { generateCourse, isLoading } = useCourseGeneration();\n  const courseId = getCourseIdFromUrl();\n\n  const handleGenerate = async ({ file, instructions }) => {\n    if (!courseId) {\n      const error = new Error('No course context found. Please make sure you are on a course page.');\n      onError(error);\n      throw error;\n    }\n\n    try {\n      // First upload the PDF file\n      const formData = new FormData();\n      formData.append('file', file);\n      \n      const uploadResponse = await fetch(uploadUrl, {\n        method: 'POST',\n        body: formData,\n        credentials: 'same-origin',\n        headers: {\n          'X-CSRFToken': getCsrfToken(),\n        },\n      });\n\n      if (!uploadResponse.ok) {\n        const errorData = await uploadResponse.json();\n        throw new Error(errorData.error || 'Failed to upload file');\n      }\n\n      const uploadResult = await uploadResponse.json();\n      \n      // Then create the generation job using the dynamic course-aware endpoint\n      const jobData = {\n        job_type: 'course_creation',\n        input_data: {\n          file_id: uploadResult.file_id,\n          instructions: instructions,\n        },\n      };\n      \n      const jobResult = await generateCourse(courseId, jobData);\n      \n      // Call success callback\n      onSuccess({\n        jobId: jobResult.id,\n        message: 'Course generation started successfully! You will be notified when it completes.',\n      });\n\n    } catch (error) {\n      console.error('Course generation error:', error);\n      onError(error);\n      throw error; // Re-throw so modal can handle it\n    }\n  };\n\n  // Helper function to get CSRF token\n  const getCsrfToken = () => {\n    const cookies = document.cookie.split(';');\n    for (let cookie of cookies) {\n      const [name, value] = cookie.trim().split('=');\n      if (name === 'csrftoken') {\n        return value;\n      }\n    }\n    // Fallback: try to get from meta tag\n    const csrfMeta = document.querySelector('meta[name=\"csrf-token\"]');\n    return csrfMeta ? csrfMeta.getAttribute('content') : '';\n  };\n\n  return (\n    <>\n      <button\n        className={buttonClassName}\n        onClick={() => setShowModal(true)}\n        disabled={!courseId || isLoading}\n        title={!courseId ? \"Course context required\" : \"Generate course content with AI\"}\n        aria-label=\"Generate course content with AI\"\n      >\n        <span className=\"icon\" style={{ marginRight: '8px' }}>\n          {buttonIcon}\n        </span>\n        {buttonText}\n      </button>\n\n      <CourseGenerationModal\n        isOpen={showModal}\n        onClose={() => setShowModal(false)}\n        onGenerate={handleGenerate}\n        maxFileSizeMB={maxFileSizeMB}\n      />\n    </>\n  );\n}\n"],"mappings":"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","ignoreList":[]}