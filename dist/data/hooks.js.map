{"version":3,"file":"hooks.js","names":["_react","require","_auth","getCourseIdFromUrl","path","window","location","pathname","includes","match","exports","getBlockIdFromContext","urlParams","URLSearchParams","search","blockId","get","blockMatch","unitElement","document","querySelector","getAttribute","blockElement","buildApiUrl","baseUrl","courseId","cleanBaseUrl","replace","encodeURIComponent","useAIChatData","chatAppData","setChatAppData","useState","showAIChat","apiUrl","title","placeholder","disabled","useEffect","config","aiChatConfig","baseApiUrl","dynamicApiUrl","prevData","useAIChat","sessionId","arguments","length","undefined","isLoading","setIsLoading","error","setError","currentSessionId","setCurrentSessionId","sendMessage","message","payload","session_id","client","getAuthenticatedHttpClient","response","post","data","err","fetch","method","headers","value","credentials","body","JSON","stringify","ok","Error","status","result","json","fetchErr","useCourseGeneration","generateCourse","formData"],"sources":["../../src/data/hooks.js"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport { getAuthenticatedHttpClient } from '@edx/frontend-platform/auth';\n\n/**\n * Extract course_id from current page URL using Open edX patterns\n */\nconst getCourseIdFromUrl = () => {\n  const path = window.location.pathname;\n  \n  // Pattern: /courses/course-v1:org+course+run/...\n  if (path.includes('/courses/')) {\n    const match = path.match(/\\/courses\\/([^/]+)/);\n    if (match && match[1] && match[1].includes('course-v1:')) {\n      return match[1];\n    }\n  }\n  \n  // Pattern: /course/course-v1:org+course+run/...\n  if (path.includes('/course/')) {\n    const match = path.match(/\\/course\\/([^/]+)/);\n    if (match && match[1] && match[1].includes('course-v1:')) {\n      return match[1];\n    }\n  }\n  \n  return null;\n};\n\n/**\n * Extract block_id from current page URL or DOM\n */\nconst getBlockIdFromContext = () => {\n  // Try to get from URL hash or query params first\n  const urlParams = new URLSearchParams(window.location.search);\n  const blockId = urlParams.get('block_id') || urlParams.get('unit_id');\n  if (blockId) return blockId;\n  \n  // Try to get from URL path\n  const path = window.location.pathname;\n  const blockMatch = path.match(/block-v1:[^/]+/);\n  if (blockMatch) return blockMatch[0];\n  \n  // Try to get from DOM data attributes (common in Open edX)\n  const unitElement = document.querySelector('[data-unit-id]');\n  if (unitElement) return unitElement.getAttribute('data-unit-id');\n  \n  const blockElement = document.querySelector('[data-block-id]');\n  if (blockElement) return blockElement.getAttribute('data-block-id');\n  \n  return null;\n};\n\n/**\n * Build dynamic API URL with course and block context\n */\nconst buildApiUrl = (baseUrl, courseId, blockId) => {\n  // Remove trailing slash from baseUrl\n  const cleanBaseUrl = baseUrl.replace(/\\/$/, '');\n  \n  if (courseId && blockId) {\n    return `${cleanBaseUrl}/${encodeURIComponent(courseId)}/${encodeURIComponent(blockId)}/`;\n  } else if (courseId) {\n    return `${cleanBaseUrl}/${encodeURIComponent(courseId)}/`;\n  }\n  \n  // Fallback to original URL if no context found\n  return baseUrl;\n};\n\n/**\n * Hook to manage AI chat application data and configuration\n */\nexport const useAIChatData = () => {\n  const [chatAppData, setChatAppData] = useState({\n    showAIChat: true,\n    apiUrl: '/api/ai-assistant/chat',\n    title: 'AI Assistant',\n    placeholder: 'Ask me anything...',\n    disabled: false,\n  });\n\n  useEffect(() => {\n    // Initialize chat configuration from global config or environment\n    const config = window.aiChatConfig || {};\n    \n    // Extract course and block context\n    const courseId = getCourseIdFromUrl();\n    const blockId = getBlockIdFromContext();\n    \n    // Build dynamic API URL with context\n    const baseApiUrl = config.apiUrl || '/api/ai-assistant/chat';\n    const dynamicApiUrl = buildApiUrl(baseApiUrl, courseId, blockId);\n    \n    setChatAppData(prevData => ({\n      ...prevData,\n      ...config,\n      apiUrl: dynamicApiUrl,\n      courseId,\n      blockId,\n    }));\n  }, []);\n\n  return { chatAppData };\n};\n\n/**\n * Hook to handle AI chat messaging\n */\nexport const useAIChat = (apiUrl, sessionId = null) => {\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState(null);\n  const [currentSessionId, setCurrentSessionId] = useState(sessionId);\n\n  const sendMessage = async (message) => {\n    setIsLoading(true);\n    setError(null);\n    \n    try {\n      const payload = { message };\n      if (currentSessionId) {\n        payload.session_id = currentSessionId;\n      }\n      \n      const client = getAuthenticatedHttpClient();\n      const response = await client.post(apiUrl, payload);\n      \n      // Extract session_id from response if available\n      if (response.data?.session_id && !currentSessionId) {\n        setCurrentSessionId(response.data.session_id);\n      }\n      \n      return response.data;\n    } catch (err) {\n      // Fallback to fetch for cross-origin issues or when authenticated client fails\n      try {\n        const payload = { message };\n        if (currentSessionId) {\n          payload.session_id = currentSessionId;\n        }\n        \n        const response = await fetch(apiUrl, {\n          method: 'POST',\n          headers: { \n            'Content-Type': 'application/json',\n            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]')?.value || ''\n          },\n          credentials: 'include',\n          body: JSON.stringify(payload),\n        });\n        \n        if (!response.ok) {\n          throw new Error(`HTTP ${response.status}`);\n        }\n        \n        const result = await response.json();\n        \n        // Extract session_id from response if available\n        if (result?.session_id && !currentSessionId) {\n          setCurrentSessionId(result.session_id);\n        }\n        \n        return result;\n      } catch (fetchErr) {\n        setError(fetchErr.message);\n        throw fetchErr;\n      }\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return { sendMessage, isLoading, error, sessionId: currentSessionId };\n};\n\n/**\n * Hook for course generation functionality\n */\nexport const useCourseGeneration = () => {\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState(null);\n  \n  const generateCourse = async (courseId, formData) => {\n    setIsLoading(true);\n    setError(null);\n    \n    try {\n      const client = getAuthenticatedHttpClient();\n      const apiUrl = `/api/ai-assistant/generate/${encodeURIComponent(courseId)}/`;\n      const response = await client.post(apiUrl, formData);\n      return response.data;\n    } catch (err) {\n      setError(err.message);\n      throw err;\n    } finally {\n      setIsLoading(false);\n    }\n  };\n  \n  return { generateCourse, isLoading, error };\n};\n\n// Export utility functions for external use\nexport { getCourseIdFromUrl, getBlockIdFromContext, buildApiUrl };\n"],"mappings":"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","ignoreList":[]}