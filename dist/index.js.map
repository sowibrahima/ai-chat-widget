{"version":3,"file":"index.js","names":["_react","_interopRequireWildcard","require","_AIChatWidget","_interopRequireDefault","_hooks","e","__esModule","default","t","WeakMap","r","n","o","i","f","__proto__","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","AIChatTray","chatAppData","useAIChatData","showAIChat","createElement","StrictMode","exports","_default","mountAIWidget","_ref","container","onSend","onStartStream","title","placeholder","disabled","ReactDOM","render","React","AIChatWidget","createSendHandler","apiUrl","message","response","fetch","method","headers","document","querySelector","value","credentials","body","JSON","stringify","ok","Error","status","json","defaultSend","baseUrl","res","initStandalone","window","location","origin","arguments","length","undefined","root","getElementById","id","appendChild","m","initPlugin","options","api","PluginAPI","openEdx","plugin","edx","plugins","fill","slotName","register","renderWidget","el","learningFooter","studioFooter","attachedToLearning","attachedToStudio","createConfiguredWidget","config","ConfiguredAIChatWidget","props"],"sources":["../src/index.js"],"sourcesContent":["import React, { StrictMode } from 'react';\nimport AIChatWidget from './AIChatWidget';\nimport { useAIChatData } from './data/hooks';\n\nexport const AIChatTray = () => {\n  const { chatAppData } = useAIChatData();\n  return chatAppData?.showAIChat\n    ? <StrictMode><AIChatWidget chatAppData={chatAppData} /></StrictMode>\n    : '';\n};\n\nexport default AIChatTray;\nexport { AIChatWidget, useAIChatData };\n\n// Helper: mount widget into a DOM container\nexport function mountAIWidget({\n  container,\n  onSend,\n  onStartStream,\n  title,\n  placeholder,\n  disabled,\n}) {\n  if (!container) return;\n  ReactDOM.render(\n    React.createElement(AIChatWidget, { onSend, onStartStream, title, placeholder, disabled }),\n    container\n  );\n}\n\n// Factory function to create a send handler with configurable API URL\nexport function createSendHandler(apiUrl) {\n  return async function(message) {\n    const response = await fetch(apiUrl, {\n      method: 'POST',\n      headers: { \n        'Content-Type': 'application/json',\n        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]')?.value || ''\n      },\n      credentials: 'include',\n      body: JSON.stringify({ message }),\n    });\n    if (!response.ok) throw new Error(`HTTP ${response.status}`);\n    return await response.json();\n  };\n}\n\n// Minimal default networking using fetch; MFEs should pass authenticatedHttpClient alternatives\nasync function defaultSend(message, baseUrl) {\n  const res = await fetch(`${baseUrl}/api/ai-assistant/chat`, {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    credentials: 'include',\n    body: JSON.stringify({ message }),\n  });\n  if (!res.ok) throw new Error(`HTTP ${res.status}`);\n  return await res.json();\n}\n\nexport function initStandalone({ baseUrl = window.location.origin } = {}) {\n  // Non-plugin fallback for any page\n  let root = document.getElementById('ai-widget-root');\n  if (!root) {\n    root = document.createElement('div');\n    root.id = 'ai-widget-root';\n    document.body.appendChild(root);\n  }\n  return mountAIWidget({\n    container: root,\n    onSend: (m) => defaultSend(m, baseUrl),\n    onStartStream: () => {},\n  });\n}\n\n// Plugin bootstrap for MFEs with a plugin/slot API\nexport function initPlugin(options = {}) {\n  const api =\n    window?.PluginAPI || // potential plugin API\n    window?.openEdx?.plugin ||\n    window?.edx?.plugins ||\n    null;\n\n  const fill = (slotName, render) => {\n    // Generic slot registration if an API is available\n    if (api && typeof api.register === 'function') {\n      api.register(slotName, render);\n      return true;\n    }\n    return false;\n  };\n\n  const renderWidget = (el) => {\n    if (!el) return;\n    const baseUrl = options.baseUrl || window.location.origin;\n    mountAIWidget({\n      container: el,\n      onSend: (m) => (options.onSend ? options.onSend(m) : defaultSend(m, baseUrl)),\n      onStartStream: options.onStartStream || (() => {}),\n      title: options.title,\n      placeholder: options.placeholder,\n      disabled: options.disabled,\n    });\n  };\n\n  // Known footer slots\n  const learningFooter = 'org.openedx.frontend.layout.footer.v1';\n  const studioFooter = 'org.openedx.frontend.layout.studio_footer.v1';\n\n  const attachedToLearning = fill(learningFooter, renderWidget);\n  const attachedToStudio = fill(studioFooter, renderWidget);\n\n  if (!attachedToLearning && !attachedToStudio) {\n    // Fallback: mount globally\n    initStandalone(options);\n  }\n}\n\n// Factory to create a pre-configured widget component\nexport function createConfiguredWidget(config) {\n  return function ConfiguredAIChatWidget(props) {\n    return React.createElement(AIChatWidget, {\n      ...props,\n      onSend: config.apiUrl ? createSendHandler(config.apiUrl) : props.onSend,\n      title: config.title || props.title,\n    });\n  };\n}\n"],"mappings":"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","ignoreList":[]}