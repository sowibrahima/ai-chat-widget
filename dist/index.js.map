{"version":3,"file":"index.js","names":["_react","_interopRequireWildcard","require","_auth","_AIChatWidget","_interopRequireDefault","_CourseGenerationModal","_CourseGenerationButton","_hooks","e","__esModule","default","t","WeakMap","r","n","o","i","f","__proto__","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","AIChatTray","chatAppData","useAIChatData","showAIChat","createElement","StrictMode","exports","_default","mountAIWidget","_ref","container","onSend","onStartStream","title","placeholder","disabled","ReactDOM","render","React","AIChatWidget","createSendHandler","apiUrl","message","client","getAuthenticatedHttpClient","response","post","data","error","res","fetch","method","headers","document","querySelector","value","credentials","body","JSON","stringify","ok","Error","status","json","defaultSend","baseUrl","initStandalone","window","location","origin","arguments","length","undefined","root","getElementById","id","appendChild","m","initPlugin","options","api","PluginAPI","openEdx","plugin","edx","plugins","fill","slotName","register","renderWidget","el","learningFooter","studioFooter","attachedToLearning","attachedToStudio","createConfiguredWidget","config","ConfiguredAIChatWidget","props","openCourseGenerationModal","courseId","getCourseIdFromUrl","onSuccess","onError","onClose","modalContainer","handleClose","unmountComponentAtNode","handleSuccess","result","handleError","CourseGenerationModal","modalProps","isOpen","showSimpleCourseGenerationModal","modalHtml","innerHTML","instructionsTextarea","charCount","submitBtn","addEventListener","textContent","handleSimpleFormSubmit","WSAIAssistant","closeCourseGenerationModal","remove","fileInput","progressDiv","progressBar","statusText","errorDiv","file","files","instructions","trim","showSimpleError","size","style","display","formData","FormData","append","getCsrfToken","then","uploadResult","job_type","input_type","file_path","jobResult","startSimplePolling","catch","jobId","pollInterval","setInterval","jobData","progress","progress_percent","width","clearInterval","error_message","console","cookies","cookie","split","name","getAttribute","path","pathname","match","initializeWSAIAssistant","log","CourseGenerationButton","initialize"],"sources":["../src/index.js"],"sourcesContent":["import React, { StrictMode } from 'react';\nimport { getAuthenticatedHttpClient } from '@edx/frontend-platform/auth';\nimport AIChatWidget from './AIChatWidget';\nimport CourseGenerationModal from './CourseGenerationModal';\nimport CourseGenerationButton from './CourseGenerationButton';\nimport { useAIChatData } from './data/hooks';\n\nexport const AIChatTray = () => {\n  const { chatAppData } = useAIChatData();\n  return chatAppData?.showAIChat\n    ? <StrictMode><AIChatWidget chatAppData={chatAppData} /></StrictMode>\n    : '';\n};\n\nexport default AIChatTray;\nexport { AIChatWidget, CourseGenerationModal, CourseGenerationButton, useAIChatData };\n\n// Helper: mount widget into a DOM container\nexport function mountAIWidget({\n  container,\n  onSend,\n  onStartStream,\n  title,\n  placeholder,\n  disabled,\n}) {\n  if (!container) return;\n  ReactDOM.render(\n    React.createElement(AIChatWidget, { onSend, onStartStream, title, placeholder, disabled }),\n    container\n  );\n}\n\n// Factory function to create a send handler with configurable API URL\nexport function createSendHandler(apiUrl) {\n  return async function(message) {\n    try {\n      const client = getAuthenticatedHttpClient();\n      const response = await client.post(apiUrl, { message });\n      return response.data;\n    } catch (error) {\n      // Fallback to fetch for cross-origin issues or when authenticated client fails\n      const res = await fetch(apiUrl, {\n        method: 'POST',\n        headers: { \n          'Content-Type': 'application/json',\n          'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]')?.value || ''\n        },\n        credentials: 'include',\n        body: JSON.stringify({ message }),\n      });\n      if (!res.ok) throw new Error(`HTTP ${res.status}`);\n      return await res.json();\n    }\n  };\n}\n\n// Default networking using authenticated client for MFE environments\nasync function defaultSend(message, baseUrl) {\n  try {\n    const client = getAuthenticatedHttpClient();\n    const response = await client.post(`${baseUrl}/api/ai-assistant/chat`, { message });\n    return response.data;\n  } catch (error) {\n    // Fallback to fetch for non-MFE environments where authenticated client might not be available\n    const res = await fetch(`${baseUrl}/api/ai-assistant/chat`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      credentials: 'include',\n      body: JSON.stringify({ message }),\n    });\n    if (!res.ok) throw new Error(`HTTP ${res.status}`);\n    return await res.json();\n  }\n}\n\nexport function initStandalone({ baseUrl = window.location.origin } = {}) {\n  // Non-plugin fallback for any page\n  let root = document.getElementById('ai-widget-root');\n  if (!root) {\n    root = document.createElement('div');\n    root.id = 'ai-widget-root';\n    document.body.appendChild(root);\n  }\n  return mountAIWidget({\n    container: root,\n    onSend: (m) => defaultSend(m, baseUrl),\n    onStartStream: () => {},\n  });\n}\n\n// Plugin bootstrap for MFEs with a plugin/slot API\nexport function initPlugin(options = {}) {\n  const api =\n    window?.PluginAPI || // potential plugin API\n    window?.openEdx?.plugin ||\n    window?.edx?.plugins ||\n    null;\n\n  const fill = (slotName, render) => {\n    // Generic slot registration if an API is available\n    if (api && typeof api.register === 'function') {\n      api.register(slotName, render);\n      return true;\n    }\n    return false;\n  };\n\n  const renderWidget = (el) => {\n    if (!el) return;\n    const baseUrl = options.baseUrl || window.location.origin;\n    mountAIWidget({\n      container: el,\n      onSend: (m) => (options.onSend ? options.onSend(m) : defaultSend(m, baseUrl)),\n      onStartStream: options.onStartStream || (() => {}),\n      title: options.title,\n      placeholder: options.placeholder,\n      disabled: options.disabled,\n    });\n  };\n\n  // Known footer slots\n  const learningFooter = 'org.openedx.frontend.layout.footer.v1';\n  const studioFooter = 'org.openedx.frontend.layout.studio_footer.v1';\n\n  const attachedToLearning = fill(learningFooter, renderWidget);\n  const attachedToStudio = fill(studioFooter, renderWidget);\n\n  if (!attachedToLearning && !attachedToStudio) {\n    // Fallback: mount globally\n    initStandalone(options);\n  }\n}\n\n// Factory to create a pre-configured widget component\nexport function createConfiguredWidget(config) {\n  return function ConfiguredAIChatWidget(props) {\n    return React.createElement(AIChatWidget, {\n      ...props,\n      onSend: config.apiUrl ? createSendHandler(config.apiUrl) : props.onSend,\n      title: config.title || props.title,\n    });\n  };\n}\n\n// Global function to open course generation modal\nexport function openCourseGenerationModal(options = {}) {\n  const {\n    courseId = getCourseIdFromUrl(),\n    onSuccess = () => {},\n    onError = () => {},\n    onClose = () => {}\n  } = options;\n\n  if (!courseId) {\n    const error = new Error('Could not determine course ID from URL');\n    onError(error);\n    return;\n  }\n\n  // Create modal container\n  let modalContainer = document.getElementById('ws-ai-assistant-modal-container');\n  if (!modalContainer) {\n    modalContainer = document.createElement('div');\n    modalContainer.id = 'ws-ai-assistant-modal-container';\n    document.body.appendChild(modalContainer);\n  }\n\n  const handleClose = () => {\n    if (window.ReactDOM && modalContainer) {\n      window.ReactDOM.unmountComponentAtNode(modalContainer);\n    }\n    onClose();\n  };\n\n  const handleSuccess = (result) => {\n    onSuccess(result);\n    handleClose();\n  };\n\n  const handleError = (error) => {\n    onError(error);\n    handleClose();\n  };\n\n  // Try to use React components if available\n  if (window.React && window.ReactDOM && CourseGenerationModal) {\n    const modalProps = {\n      isOpen: true,\n      courseId: courseId,\n      onClose: handleClose,\n      onSuccess: handleSuccess,\n      onError: handleError,\n    };\n\n    window.ReactDOM.render(\n      window.React.createElement(CourseGenerationModal, modalProps),\n      modalContainer\n    );\n  } else {\n    // Fallback to simple HTML modal\n    showSimpleCourseGenerationModal(courseId, handleSuccess, handleError, handleClose);\n  }\n}\n\n// Fallback simple modal implementation\nfunction showSimpleCourseGenerationModal(courseId, onSuccess, onError, onClose) {\n  const modalHtml = `\n    <div class=\"modal fade show\" style=\"display: block; z-index: 10000;\" tabindex=\"-1\">\n      <div class=\"modal-dialog modal-lg\">\n        <div class=\"modal-content\">\n          <div class=\"modal-header\">\n            <h5 class=\"modal-title\">\n              <span class=\"fa fa-magic\" style=\"margin-right: 8px;\"></span>\n              Génération de cours avec IA\n            </h5>\n            <button type=\"button\" class=\"close\" onclick=\"window.WSAIAssistant.closeCourseGenerationModal()\">\n              <span>&times;</span>\n            </button>\n          </div>\n          <div class=\"modal-body\">\n            <form id=\"ws-ai-course-form\">\n              <div class=\"form-group\">\n                <label>PDF Document:</label>\n                <input type=\"file\" class=\"form-control-file\" id=\"ws-ai-file\" accept=\".pdf\" required>\n                <small class=\"text-muted\">Upload a PDF document (max 50MB)</small>\n              </div>\n              <div class=\"form-group\">\n                <label>Instructions de génération:</label>\n                <textarea class=\"form-control\" id=\"ws-ai-instructions\" rows=\"4\" maxlength=\"1000\" required\n                  placeholder=\"Describe what kind of course content you want to generate. For example: 'Create a comprehensive course with modules, lessons, quizzes, and assignments based on this document. Focus on practical applications and include interactive elements.'\"></textarea>\n                <small class=\"text-muted\">\n                  <span id=\"ws-ai-char-count\">0</span>/1000 characters\n                </small>\n              </div>\n              <div id=\"ws-ai-progress\" class=\"form-group\" style=\"display: none;\">\n                <label>Progression de la génération:</label>\n                <div class=\"progress\">\n                  <div id=\"ws-ai-progress-bar\" class=\"progress-bar\" role=\"progressbar\" style=\"width: 0%\"></div>\n                </div>\n                <small id=\"ws-ai-status\" class=\"text-muted\">Starting...</small>\n              </div>\n              <div id=\"ws-ai-error\" class=\"alert alert-danger\" style=\"display: none;\"></div>\n            </form>\n          </div>\n          <div class=\"modal-footer\">\n            <button type=\"button\" class=\"btn-ai-chat btn-ai-chat-secondary\" onclick=\"window.WSAIAssistant.closeCourseGenerationModal()\">Annuler</button>\n            <button type=\"button\" class=\"btn-ai-chat btn-ai-chat-primary\" id=\"ws-ai-submit\">\n              <span class=\"fa fa-magic\" style=\"margin-right: 6px;\"></span>\n              Générer le cours\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n    <div class=\"modal-backdrop fade show\" style=\"z-index: 9999;\"></div>\n  `;\n\n  const modalContainer = document.createElement('div');\n  modalContainer.id = 'ws-ai-simple-modal';\n  modalContainer.innerHTML = modalHtml;\n  document.body.appendChild(modalContainer);\n\n  // Add event listeners\n  const instructionsTextarea = document.getElementById('ws-ai-instructions');\n  const charCount = document.getElementById('ws-ai-char-count');\n  const submitBtn = document.getElementById('ws-ai-submit');\n\n  instructionsTextarea.addEventListener('input', function() {\n    charCount.textContent = this.value.length;\n  });\n\n  submitBtn.addEventListener('click', function() {\n    handleSimpleFormSubmit(courseId, onSuccess, onError);\n  });\n\n  // Store close function globally\n  window.WSAIAssistant = window.WSAIAssistant || {};\n  window.WSAIAssistant.closeCourseGenerationModal = () => {\n    const container = document.getElementById('ws-ai-simple-modal');\n    if (container) {\n      container.remove();\n    }\n    onClose();\n  };\n}\n\nfunction handleSimpleFormSubmit(courseId, onSuccess, onError) {\n  const fileInput = document.getElementById('ws-ai-file');\n  const instructionsTextarea = document.getElementById('ws-ai-instructions');\n  const submitBtn = document.getElementById('ws-ai-submit');\n  const progressDiv = document.getElementById('ws-ai-progress');\n  const progressBar = document.getElementById('ws-ai-progress-bar');\n  const statusText = document.getElementById('ws-ai-status');\n  const errorDiv = document.getElementById('ws-ai-error');\n\n  const file = fileInput.files[0];\n  const instructions = instructionsTextarea.value.trim();\n\n  if (!file || !instructions) {\n    showSimpleError('Please fill in all required fields');\n    return;\n  }\n\n  if (file.size > 50 * 1024 * 1024) {\n    showSimpleError('File size must be less than 50MB');\n    return;\n  }\n\n  // Show progress\n  submitBtn.disabled = true;\n  submitBtn.textContent = 'Génération...';\n  progressDiv.style.display = 'block';\n  errorDiv.style.display = 'none';\n\n  // Upload file\n  const formData = new FormData();\n  formData.append('file', file);\n\n  fetch('/api/ai-assistant/upload/', {\n    method: 'POST',\n    body: formData,\n    credentials: 'same-origin',\n    headers: {\n      'X-CSRFToken': getCsrfToken()\n    }\n  })\n  .then(response => response.json())\n  .then(uploadResult => {\n    if (uploadResult.error) throw new Error(uploadResult.error);\n\n    // Create generation job\n    return fetch(`/api/ai-assistant/generate/${courseId}/`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'X-CSRFToken': getCsrfToken()\n      },\n      credentials: 'same-origin',\n      body: JSON.stringify({\n        job_type: 'course_generation',\n        instructions: instructions,\n        input_type: 'file',\n        file_path: uploadResult.file_path\n      })\n    });\n  })\n  .then(response => response.json())\n  .then(jobResult => {\n    if (jobResult.error) throw new Error(jobResult.error);\n\n    statusText.textContent = 'Processing...';\n    startSimplePolling(jobResult.id, progressBar, statusText, onSuccess, onError);\n  })\n  .catch(error => {\n    showSimpleError(error.message);\n    submitBtn.disabled = false;\n    submitBtn.innerHTML = '<span class=\"fa fa-magic\" style=\"margin-right: 6px;\"></span>Générer le cours';\n  });\n\n  function showSimpleError(message) {\n    errorDiv.textContent = message;\n    errorDiv.style.display = 'block';\n  }\n}\n\nfunction startSimplePolling(jobId, progressBar, statusText, onSuccess, onError) {\n  const pollInterval = setInterval(() => {\n    fetch(`/api/ai-assistant/generate/jobs/${jobId}/`, {\n      credentials: 'same-origin',\n      headers: {\n        'X-CSRFToken': getCsrfToken()\n      }\n    })\n    .then(response => response.json())\n    .then(jobData => {\n      const progress = jobData.progress_percent || 0;\n      progressBar.style.width = progress + '%';\n      statusText.textContent = `${progress}% - ${jobData.status}`;\n\n      if (jobData.status === 'completed') {\n        clearInterval(pollInterval);\n        onSuccess({\n          jobId: jobData.id,\n          message: 'Génération du cours terminée avec succès!',\n          jobData: jobData\n        });\n      } else if (jobData.status === 'failed') {\n        clearInterval(pollInterval);\n        onError(new Error(jobData.error_message || 'Génération du cours échouée'));\n      }\n    })\n    .catch(error => {\n      console.error('Polling error:', error);\n    });\n  }, 2000);\n}\n\nfunction getCsrfToken() {\n  const cookies = document.cookie.split(';');\n  for (let cookie of cookies) {\n    const [name, value] = cookie.trim().split('=');\n    if (name === 'csrftoken') return value;\n  }\n  return document.querySelector('meta[name=\"csrf-token\"]')?.getAttribute('content') || '';\n}\n\nfunction getCourseIdFromUrl() {\n  const path = window.location.pathname;\n  const match = path.match(/\\/course\\/([^/]+)/);\n  return match ? match[1] : null;\n}\n\n// Legacy fallback for non-MFE environments (no longer needed since Studio uses authoring MFE)\n// Keeping minimal implementation for backwards compatibility\nfunction initializeWSAIAssistant() {\n  console.log('WSAIAssistant initialized - using MFE plugin slots for modern Studio integration');\n}\n\n// Expose globally for Tutor plugin integration\nif (typeof window !== 'undefined') {\n  window.WSAIAssistant = window.WSAIAssistant || {};\n  window.WSAIAssistant.openCourseGenerationModal = openCourseGenerationModal;\n  window.WSAIAssistant.CourseGenerationModal = CourseGenerationModal;\n  window.WSAIAssistant.CourseGenerationButton = CourseGenerationButton;\n  window.WSAIAssistant.initialize = initializeWSAIAssistant;\n  \n  // Auto-initialize\n  initializeWSAIAssistant();\n}\n"],"mappings":"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","ignoreList":[]}