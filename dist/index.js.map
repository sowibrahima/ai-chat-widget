{"version":3,"file":"index.js","names":["_react","_interopRequireWildcard","require","_auth","_AIChatWidget","_interopRequireDefault","_hooks","e","__esModule","default","t","WeakMap","r","n","o","i","f","__proto__","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","AIChatTray","chatAppData","useAIChatData","showAIChat","createElement","StrictMode","exports","_default","mountAIWidget","_ref","container","onSend","onStartStream","title","placeholder","disabled","ReactDOM","render","React","AIChatWidget","createSendHandler","apiUrl","message","client","getAuthenticatedHttpClient","response","post","data","error","res","fetch","method","headers","document","querySelector","value","credentials","body","JSON","stringify","ok","Error","status","json","defaultSend","baseUrl","initStandalone","window","location","origin","arguments","length","undefined","root","getElementById","id","appendChild","m","initPlugin","options","api","PluginAPI","openEdx","plugin","edx","plugins","fill","slotName","register","renderWidget","el","learningFooter","studioFooter","attachedToLearning","attachedToStudio","createConfiguredWidget","config","ConfiguredAIChatWidget","props"],"sources":["../src/index.js"],"sourcesContent":["import React, { StrictMode } from 'react';\nimport { getAuthenticatedHttpClient } from '@edx/frontend-platform/auth';\nimport AIChatWidget from './AIChatWidget';\nimport { useAIChatData } from './data/hooks';\n\nexport const AIChatTray = () => {\n  const { chatAppData } = useAIChatData();\n  return chatAppData?.showAIChat\n    ? <StrictMode><AIChatWidget chatAppData={chatAppData} /></StrictMode>\n    : '';\n};\n\nexport default AIChatTray;\nexport { AIChatWidget, useAIChatData };\n\n// Helper: mount widget into a DOM container\nexport function mountAIWidget({\n  container,\n  onSend,\n  onStartStream,\n  title,\n  placeholder,\n  disabled,\n}) {\n  if (!container) return;\n  ReactDOM.render(\n    React.createElement(AIChatWidget, { onSend, onStartStream, title, placeholder, disabled }),\n    container\n  );\n}\n\n// Factory function to create a send handler with configurable API URL\nexport function createSendHandler(apiUrl) {\n  return async function(message) {\n    try {\n      const client = getAuthenticatedHttpClient();\n      const response = await client.post(apiUrl, { message });\n      return response.data;\n    } catch (error) {\n      // Fallback to fetch for cross-origin issues or when authenticated client fails\n      const res = await fetch(apiUrl, {\n        method: 'POST',\n        headers: { \n          'Content-Type': 'application/json',\n          'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]')?.value || ''\n        },\n        credentials: 'include',\n        body: JSON.stringify({ message }),\n      });\n      if (!res.ok) throw new Error(`HTTP ${res.status}`);\n      return await res.json();\n    }\n  };\n}\n\n// Default networking using authenticated client for MFE environments\nasync function defaultSend(message, baseUrl) {\n  try {\n    const client = getAuthenticatedHttpClient();\n    const response = await client.post(`${baseUrl}/api/ai-assistant/chat`, { message });\n    return response.data;\n  } catch (error) {\n    // Fallback to fetch for non-MFE environments where authenticated client might not be available\n    const res = await fetch(`${baseUrl}/api/ai-assistant/chat`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      credentials: 'include',\n      body: JSON.stringify({ message }),\n    });\n    if (!res.ok) throw new Error(`HTTP ${res.status}`);\n    return await res.json();\n  }\n}\n\nexport function initStandalone({ baseUrl = window.location.origin } = {}) {\n  // Non-plugin fallback for any page\n  let root = document.getElementById('ai-widget-root');\n  if (!root) {\n    root = document.createElement('div');\n    root.id = 'ai-widget-root';\n    document.body.appendChild(root);\n  }\n  return mountAIWidget({\n    container: root,\n    onSend: (m) => defaultSend(m, baseUrl),\n    onStartStream: () => {},\n  });\n}\n\n// Plugin bootstrap for MFEs with a plugin/slot API\nexport function initPlugin(options = {}) {\n  const api =\n    window?.PluginAPI || // potential plugin API\n    window?.openEdx?.plugin ||\n    window?.edx?.plugins ||\n    null;\n\n  const fill = (slotName, render) => {\n    // Generic slot registration if an API is available\n    if (api && typeof api.register === 'function') {\n      api.register(slotName, render);\n      return true;\n    }\n    return false;\n  };\n\n  const renderWidget = (el) => {\n    if (!el) return;\n    const baseUrl = options.baseUrl || window.location.origin;\n    mountAIWidget({\n      container: el,\n      onSend: (m) => (options.onSend ? options.onSend(m) : defaultSend(m, baseUrl)),\n      onStartStream: options.onStartStream || (() => {}),\n      title: options.title,\n      placeholder: options.placeholder,\n      disabled: options.disabled,\n    });\n  };\n\n  // Known footer slots\n  const learningFooter = 'org.openedx.frontend.layout.footer.v1';\n  const studioFooter = 'org.openedx.frontend.layout.studio_footer.v1';\n\n  const attachedToLearning = fill(learningFooter, renderWidget);\n  const attachedToStudio = fill(studioFooter, renderWidget);\n\n  if (!attachedToLearning && !attachedToStudio) {\n    // Fallback: mount globally\n    initStandalone(options);\n  }\n}\n\n// Factory to create a pre-configured widget component\nexport function createConfiguredWidget(config) {\n  return function ConfiguredAIChatWidget(props) {\n    return React.createElement(AIChatWidget, {\n      ...props,\n      onSend: config.apiUrl ? createSendHandler(config.apiUrl) : props.onSend,\n      title: config.title || props.title,\n    });\n  };\n}\n"],"mappings":"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","ignoreList":[]}