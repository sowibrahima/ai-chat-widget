/*! For license information please see ai-chat-plugin.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react"),require("react-dom")):"function"==typeof define&&define.amd?define("aiChatWidget",["react","react-dom"],t):"object"==typeof exports?exports.aiChatWidget=t(require("react"),require("react-dom")):e.aiChatWidget=t(e.React,e.ReactDOM)}(self,(e,t)=>(()=>{"use strict";var n={12:t=>{t.exports=e},33:e=>{e.exports=t},56:(e,t,n)=>{e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},72:e=>{var t=[];function n(e){for(var n=-1,r=0;r<t.length;r++)if(t[r].identifier===e){n=r;break}return n}function r(e,r){for(var a={},i=[],s=0;s<e.length;s++){var A=e[s],c=r.base?A[0]+r.base:A[0],d=a[c]||0,p="".concat(c," ").concat(d);a[c]=d+1;var l=n(p),u={css:A[1],media:A[2],sourceMap:A[3],supports:A[4],layer:A[5]};if(-1!==l)t[l].references++,t[l].updater(u);else{var f=o(u,r);r.byIndex=s,t.splice(s,0,{identifier:p,updater:f,references:1})}i.push(p)}return i}function o(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,o){var a=r(e=e||[],o=o||{});return function(e){e=e||[];for(var i=0;i<a.length;i++){var s=n(a[i]);t[s].references--}for(var A=r(e,o),c=0;c<a.length;c++){var d=n(a[c]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}a=A}}},113:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},314:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var n="",r=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),r&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),r&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n}).join("")},t.i=function(e,n,r,o,a){"string"==typeof e&&(e=[[null,e,void 0]]);var i={};if(r)for(var s=0;s<this.length;s++){var A=this[s][0];null!=A&&(i[A]=!0)}for(var c=0;c<e.length;c++){var d=[].concat(e[c]);r&&i[d[0]]||(void 0!==a&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=a),n&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=n):d[2]=n),o&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=o):d[4]="".concat(o)),t.push(d))}},t}},354:e=>{e.exports=function(e){var t=e[1],n=e[3];if(!n)return t;if("function"==typeof btoa){var r=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),o="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(r),a="/*# ".concat(o," */");return[t].concat([a]).join("\n")}return[t].join("\n")}},540:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},659:e=>{var t={};e.exports=function(e,n){var r=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(n)}},698:(e,t)=>{var n=Symbol.for("react.transitional.element");function r(e,t,r){var o=null;if(void 0!==r&&(o=""+r),void 0!==t.key&&(o=""+t.key),"key"in t)for(var a in r={},t)"key"!==a&&(r[a]=t[a]);else r=t;return t=r.ref,{$$typeof:n,type:e,key:o,ref:void 0!==t?t:null,props:r}}Symbol.for("react.fragment"),t.jsx=r,t.jsxs=r},787:(e,t,n)=>{n.d(t,{A:()=>s});var r=n(354),o=n.n(r),a=n(314),i=n.n(a)()(o());i.push([e.id,".aiw-root{position:fixed;right:20px;bottom:20px;z-index:2147483647}\n.aiw-fab{width:52px;height:52px;border-radius:26px;border:none;cursor:pointer;background:#1f7aec;color:#fff;box-shadow:0 6px 18px rgba(0,0,0,.2);font-size:20px}\n.aiw-panel{position:fixed;right:84px;bottom:20px;width:320px;height:280px;background:#fff;border:1px solid #ddd;border-radius:10px;box-shadow:0 6px 24px rgba(0,0,0,.18);overflow:hidden;transform:translateY(16px);opacity:0;pointer-events:none;transition:all .18s ease}\n.aiw-open{opacity:1;transform:translateY(0);pointer-events:auto}\n.aiw-header{display:flex;align-items:center;justify-content:space-between;padding:8px 10px;border-bottom:1px solid #eee}\n.aiw-close{border:none;background:transparent;cursor:pointer;font-size:18px}\n.aiw-output{padding:8px 10px;height:160px;overflow-y:auto;white-space:pre-wrap;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;font-size:14px}\n.aiw-input{padding:8px 10px}\n.aiw-input textarea{width:100%;height:60px;resize:vertical;font-size:14px;padding:8px}\n.aiw-controls{display:flex;align-items:center;justify-content:flex-end;margin-top:6px}\n.aiw-btn{padding:8px 12px;background:#555;color:#fff;border:none;border-radius:6px;cursor:pointer}\n.aiw-primary{background:#1f7aec}\n.aiw-line{margin:4px 0}\n.aiw-user{color:#222}\n.aiw-assistant{color:#0b5}\n.aiw-error{color:#b00}\n","",{version:3,sources:["webpack://./src/AIChatWidget.css"],names:[],mappings:"AAAA,UAAU,cAAc,CAAC,UAAU,CAAC,WAAW,CAAC,kBAAkB;AAClE,SAAS,UAAU,CAAC,WAAW,CAAC,kBAAkB,CAAC,WAAW,CAAC,cAAc,CAAC,kBAAkB,CAAC,UAAU,CAAC,oCAAoC,CAAC,cAAc;AAC/J,WAAW,cAAc,CAAC,UAAU,CAAC,WAAW,CAAC,WAAW,CAAC,YAAY,CAAC,eAAe,CAAC,qBAAqB,CAAC,kBAAkB,CAAC,qCAAqC,CAAC,eAAe,CAAC,0BAA0B,CAAC,SAAS,CAAC,mBAAmB,CAAC,wBAAwB;AAC1Q,UAAU,SAAS,CAAC,uBAAuB,CAAC,mBAAmB;AAC/D,YAAY,YAAY,CAAC,kBAAkB,CAAC,6BAA6B,CAAC,gBAAgB,CAAC,4BAA4B;AACvH,WAAW,WAAW,CAAC,sBAAsB,CAAC,cAAc,CAAC,cAAc;AAC3E,YAAY,gBAAgB,CAAC,YAAY,CAAC,eAAe,CAAC,oBAAoB,CAAC,oEAAoE,CAAC,cAAc;AAClK,WAAW,gBAAgB;AAC3B,oBAAoB,UAAU,CAAC,WAAW,CAAC,eAAe,CAAC,cAAc,CAAC,WAAW;AACrF,cAAc,YAAY,CAAC,kBAAkB,CAAC,wBAAwB,CAAC,cAAc;AACrF,SAAS,gBAAgB,CAAC,eAAe,CAAC,UAAU,CAAC,WAAW,CAAC,iBAAiB,CAAC,cAAc;AACjG,aAAa,kBAAkB;AAC/B,UAAU,YAAY;AACtB,UAAU,UAAU;AACpB,eAAe,UAAU;AACzB,WAAW,UAAU",sourcesContent:[".aiw-root{position:fixed;right:20px;bottom:20px;z-index:2147483647}\n.aiw-fab{width:52px;height:52px;border-radius:26px;border:none;cursor:pointer;background:#1f7aec;color:#fff;box-shadow:0 6px 18px rgba(0,0,0,.2);font-size:20px}\n.aiw-panel{position:fixed;right:84px;bottom:20px;width:320px;height:280px;background:#fff;border:1px solid #ddd;border-radius:10px;box-shadow:0 6px 24px rgba(0,0,0,.18);overflow:hidden;transform:translateY(16px);opacity:0;pointer-events:none;transition:all .18s ease}\n.aiw-open{opacity:1;transform:translateY(0);pointer-events:auto}\n.aiw-header{display:flex;align-items:center;justify-content:space-between;padding:8px 10px;border-bottom:1px solid #eee}\n.aiw-close{border:none;background:transparent;cursor:pointer;font-size:18px}\n.aiw-output{padding:8px 10px;height:160px;overflow-y:auto;white-space:pre-wrap;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;font-size:14px}\n.aiw-input{padding:8px 10px}\n.aiw-input textarea{width:100%;height:60px;resize:vertical;font-size:14px;padding:8px}\n.aiw-controls{display:flex;align-items:center;justify-content:flex-end;margin-top:6px}\n.aiw-btn{padding:8px 12px;background:#555;color:#fff;border:none;border-radius:6px;cursor:pointer}\n.aiw-primary{background:#1f7aec}\n.aiw-line{margin:4px 0}\n.aiw-user{color:#222}\n.aiw-assistant{color:#0b5}\n.aiw-error{color:#b00}\n"],sourceRoot:""}]);const s=i},825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var r="";n.supports&&(r+="@supports (".concat(n.supports,") {")),n.media&&(r+="@media ".concat(n.media," {"));var o=void 0!==n.layer;o&&(r+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),r+=n.css,o&&(r+="}"),n.media&&(r+="}"),n.supports&&(r+="}");var a=n.sourceMap;a&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),t.styleTagTransform(r,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},848:(e,t,n)=>{e.exports=n(698)}},r={};function o(e){var t=r[e];if(void 0!==t)return t.exports;var a=r[e]={id:e,exports:{}};return n[e](a,a.exports,o),a.exports}o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.nc=void 0;var a={};o.r(a),o.d(a,{createConfiguredWidget:()=>N,createSendHandler:()=>j,default:()=>Y,initPlugin:()=>T,initStandalone:()=>W,mountAIWidget:()=>k});var i=o(12),s=o.n(i),A=o(33),c=o.n(A),d=o(72),p=o.n(d),l=o(825),u=o.n(l),f=o(659),C=o.n(f),x=o(56),m=o.n(x),g=o(540),b=o.n(g),h=o(113),w=o.n(h),y=o(787),v={};v.styleTagTransform=w(),v.setAttributes=m(),v.insert=C().bind(null,"head"),v.domAPI=u(),v.insertStyleElement=b(),p()(y.A,v),y.A&&y.A.locals&&y.A.locals;var S=o(848);function B({title:e="AI Assistant",placeholder:t="Ask me anything…",onSend:n,onStartStream:r,disabled:o=!1}){const[a,s]=(0,i.useState)(!1),[A,c]=(0,i.useState)(!1),[d,p]=(0,i.useState)([]),l=(0,i.useRef)(null),u=(0,i.useMemo)(()=>!o&&!A,[o,A]);function f(e,t="system"){p(n=>[...n,{id:String(n.length+1),role:t,text:e}])}return(0,S.jsxs)("div",{className:"aiw-root",children:[(0,S.jsx)("button",{type:"button",className:"aiw-fab","aria-label":"Open AI Assistant",onClick:()=>s(e=>!e),disabled:o,children:"✦"}),(0,S.jsxs)("div",{className:"aiw-panel "+(a?"aiw-open":""),children:[(0,S.jsxs)("div",{className:"aiw-header",children:[(0,S.jsx)("strong",{children:e}),(0,S.jsx)("button",{type:"button",className:"aiw-close",onClick:()=>s(!1),"aria-label":"Close",children:"×"})]}),(0,S.jsx)("div",{className:"aiw-output",role:"log","aria-live":"polite",children:d.map(e=>(0,S.jsx)("div",{className:`aiw-line aiw-${e.role}`,children:e.text},e.id))}),(0,S.jsxs)("div",{className:"aiw-input",children:[(0,S.jsx)("textarea",{ref:l,placeholder:t,disabled:!u}),(0,S.jsxs)("div",{className:"aiw-controls",children:[(0,S.jsx)("button",{type:"button",className:"aiw-btn aiw-primary",onClick:async function(){const e=(l.current?.value||"").trim();if(e&&u&&(f(`You: ${e}`,"user"),l.current.value="",n)){c(!0);try{const t=await n(e);f("string"==typeof t?t:t?.text??JSON.stringify(t),"assistant")}catch(e){f(`Error: ${e?.message||String(e)}`,"error")}finally{c(!1)}}},disabled:!u,children:"Send"}),(0,S.jsx)("button",{type:"button",className:"aiw-btn",onClick:function(){try{const e=r?.();f("[stream] started"),e&&e.close}catch(e){f(`[stream] error: ${e?.message||String(e)}`,"error")}},disabled:o,children:"Test Stream"})]})]})]})]})}function k({container:e,onSend:t,onStartStream:n,title:r,placeholder:o,disabled:a}){e&&c().render(s().createElement(B,{onSend:t,onStartStream:n,title:r,placeholder:o,disabled:a}),e)}function j(e){return async function(t){const n=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":document.querySelector("[name=csrfmiddlewaretoken]")?.value||""},credentials:"include",body:JSON.stringify({message:t})});if(!n.ok)throw new Error(`HTTP ${n.status}`);return await n.json()}}async function U(e,t){const n=await fetch(`${t}/api/ai-assistant/chat`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({message:e})});if(!n.ok)throw new Error(`HTTP ${n.status}`);return await n.json()}function W({baseUrl:e=window.location.origin}={}){let t=document.getElementById("ai-widget-root");return t||(t=document.createElement("div"),t.id="ai-widget-root",document.body.appendChild(t)),k({container:t,onSend:t=>U(t,e),onStartStream:()=>{}})}function T(e={}){const t=window?.PluginAPI||window?.openEdx?.plugin||window?.edx?.plugins||null,n=(e,n)=>!(!t||"function"!=typeof t.register||(t.register(e,n),0)),r=t=>{if(!t)return;const n=e.baseUrl||window.location.origin;k({container:t,onSend:t=>e.onSend?e.onSend(t):U(t,n),onStartStream:e.onStartStream||(()=>{}),title:e.title,placeholder:e.placeholder,disabled:e.disabled})},o=n("org.openedx.frontend.layout.footer.v1",r),a=n("org.openedx.frontend.layout.studio_footer.v1",r);o||a||W(e)}function N(e){return function(t){return s().createElement(B,{...t,onSend:e.apiUrl?j(e.apiUrl):t.onSend,title:e.title||t.title})}}const Y=B;return a})());
//# sourceMappingURL=ai-chat-plugin.js.map