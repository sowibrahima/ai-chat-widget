{"version":3,"file":"AIChatWidget.js","names":["_react","_interopRequireWildcard","require","_classnames","_interopRequireDefault","_hooks","e","__esModule","default","t","WeakMap","r","n","o","i","f","__proto__","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","AIChatWidget","_ref","chatAppData","title","placeholder","apiUrl","disabled","sendMessage","isLoading","error","useAIChat","open","setOpen","useState","busy","setBusy","lines","setLines","inputRef","useRef","canSend","useMemo","append","text","role","arguments","length","undefined","prev","id","String","handleSend","v","current","value","trim","res","JSON","stringify","message","handleStream","ctrl","onStartStream","close","createElement","className","type","onClick","map","l","key","ref"],"sources":["../src/AIChatWidget.jsx"],"sourcesContent":["import React, { useMemo, useRef, useState } from 'react';\nimport classNames from 'classnames';\nimport { useAIChat } from './data/hooks';\nimport './AIChatWidget.css';\n\n/**\n * AIChatWidget\n * - Main AI chat component following edX frontend plugin patterns\n * - Uses hooks for data management and API calls\n */\nexport default function AIChatWidget({\n  chatAppData = {},\n}) {\n  const {\n    title = 'AI Assistant',\n    placeholder = 'Ask me anything…',\n    apiUrl = '/api/ai-assistant/chat',\n    disabled = false,\n  } = chatAppData;\n\n  const { sendMessage, isLoading, error } = useAIChat(apiUrl);\n  const [open, setOpen] = useState(false);\n  const [busy, setBusy] = useState(false);\n  const [lines, setLines] = useState([]);\n  const inputRef = useRef(null);\n\n  const canSend = useMemo(() => !disabled && !busy, [disabled, busy]);\n\n  function append(text, role = 'system') {\n    setLines(prev => [...prev, { id: String(prev.length + 1), role, text }]);\n  }\n\n  async function handleSend() {\n    const v = (inputRef.current?.value || '').trim();\n    if (!v || !canSend) return;\n    append(`You: ${v}`, 'user');\n    inputRef.current.value = '';\n    setBusy(true);\n    try {\n      const res = await sendMessage(v);\n      const text = typeof res === 'string' ? res : (res?.text ?? JSON.stringify(res));\n      append(text, 'assistant');\n    } catch (e) {\n      append(`Error: ${e?.message || String(e)}`, 'error');\n    } finally {\n      setBusy(false);\n    }\n  }\n\n  function handleStream() {\n    try {\n      const ctrl = onStartStream?.();\n      append('[stream] started');\n      // Caller should append partials by controlling parent state, or replace this with prop callback.\n      // We keep a minimal message here; advanced streaming handled by integrator.\n      if (ctrl && typeof ctrl.close === 'function') {\n        // no-op; integrator will close when done\n      }\n    } catch (e) {\n      append(`[stream] error: ${e?.message || String(e)}`, 'error');\n    }\n  }\n\n  return (\n    <div className=\"aiw-root\">\n      <button\n        type=\"button\"\n        className=\"aiw-fab\"\n        aria-label=\"Open AI Assistant\"\n        onClick={() => setOpen(o => !o)}\n        disabled={disabled}\n      >\n        ✦\n      </button>\n\n      <div className={`aiw-panel ${open ? 'aiw-open' : ''}`}>\n        <div className=\"aiw-header\">\n          <strong>{title}</strong>\n          <button type=\"button\" className=\"aiw-close\" onClick={() => setOpen(false)} aria-label=\"Close\">×</button>\n        </div>\n        <div className=\"aiw-output\" role=\"log\" aria-live=\"polite\">\n          {lines.map(l => (\n            <div key={l.id} className={`aiw-line aiw-${l.role}`}>{l.text}</div>\n          ))}\n        </div>\n        <div className=\"aiw-input\">\n          <textarea ref={inputRef} placeholder={placeholder} disabled={!canSend} />\n          <div className=\"aiw-controls\">\n            <button type=\"button\" className=\"aiw-btn aiw-primary\" onClick={handleSend} disabled={!canSend}>Send</button>\n            <button type=\"button\" className=\"aiw-btn\" onClick={handleStream} disabled={disabled}>Test Stream</button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"mappings":"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","ignoreList":[]}